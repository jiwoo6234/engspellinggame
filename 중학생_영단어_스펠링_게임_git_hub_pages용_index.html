<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì¤‘í•™ìƒ ì˜ë‹¨ì–´ ìŠ¤í ë§ í€´ì¦ˆ</title>
  <meta name="description" content="ì¤‘í•™ìƒ ìˆ˜ì¤€ì˜ ì˜ë‹¨ì–´ ìŠ¤í ë§ ë§íˆê¸° ê²Œì„" />
  <style>
    :root{
      --bg:#0f172a;        /* slate-900 */
      --panel:#111827;     /* gray-900 */
      --muted:#1f2937;     /* gray-800 */
      --text:#e5e7eb;      /* gray-200 */
      --sub:#9ca3af;       /* gray-400 */
      --acc:#22c55e;       /* green-500 */
      --acc-2:#60a5fa;     /* blue-400 */
      --warn:#f59e0b;      /* amber-500 */
      --danger:#ef4444;    /* red-500 */
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 10% 0%, #0b1229, var(--bg));
      color:var(--text);
      min-height:100svh;
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .app{
      width: min(960px, 100%);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.08);
      border-radius:24px; padding:24px; box-shadow:0 10px 30px rgba(0,0,0,0.35);
      backdrop-filter: blur(6px);
    }
    header{display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap}
    .title{font-weight:800; letter-spacing:.2px; font-size:clamp(20px, 2.6vw, 28px)}
    .title small{display:block; font-weight:500; color:var(--sub); font-size:12px}
    .controls{display:flex; gap:12px; flex-wrap:wrap}
    select, button, input[type="number"]{
      background:var(--panel); color:var(--text); border:1px solid rgba(255,255,255,0.08);
      border-radius:12px; padding:10px 12px; font-size:14px; outline:none;
    }
    button{cursor:pointer; font-weight:700; transition:.15s transform ease, .2s background ease}
    button.primary{background:linear-gradient(90deg, var(--acc-2), var(--acc)); border:none}
    button:active{transform:translateY(1px)}
    main{margin-top:18px; display:grid; gap:16px}

    .statusbar{
      display:grid; grid-template-columns:1fr auto; gap:12px; align-items:center
    }
    .progress{height:10px; background:var(--muted); border-radius:999px; overflow:hidden}
    .progress > div{height:100%; width:0; background:linear-gradient(90deg, var(--acc-2), var(--acc)); transition: width .3s ease}
    .stats{font-size:13px; color:var(--sub); display:flex; gap:12px}

    .card{
      background:var(--panel); border:1px solid rgba(255,255,255,0.08); border-radius:20px; padding:20px
    }
    .prompt{font-size:14px; color:var(--sub); margin-bottom:6px}
    .word{font-size:clamp(26px, 4vw, 40px); font-weight:800; letter-spacing:.6px; margin:0 0 12px}
    .choices{display:grid; grid-template-columns:1fr; gap:12px}

    .choice{
      display:flex; align-items:center; justify-content:space-between; gap:8px;
      padding:14px 16px; border-radius:14px; border:1px solid rgba(255,255,255,0.08);
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      font-weight:700; cursor:pointer; transition:.15s transform ease, .2s border ease, .2s background ease;
    }
    .choice:hover{transform:translateY(-1px); border-color:rgba(255,255,255,0.18)}
    .choice span.kbd{opacity:.6; font-size:12px}
    .choice.correct{outline:2px solid var(--acc)}
    .choice.wrong{outline:2px solid var(--danger)}
    .choice[disabled]{opacity:.6; cursor:not-allowed}

    .feedback{display:flex; gap:10px; align-items:center; font-size:14px}
    .pill{padding:4px 10px; border-radius:999px; font-weight:800}
    .pill.ok{background:rgba(34,197,94,.15); color:#a7f3d0; border:1px solid rgba(34,197,94,.35)}
    .pill.no{background:rgba(239,68,68,.15); color:#fecaca; border:1px solid rgba(239,68,68,.35)}

    .actions{display:flex; gap:12px; flex-wrap:wrap}
    .review{display:grid; gap:8px; font-size:14px}
    .review li{list-style:none; background:var(--panel); border:1px solid rgba(255,255,255,.08); padding:10px 12px; border-radius:10px}

    footer{margin-top:8px; color:var(--sub); font-size:12px; display:flex; justify-content:space-between; gap:8px; flex-wrap:wrap}

    @media (min-width:720px){
      .choices{grid-template-columns:1fr 1fr}
    }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="ì˜ë‹¨ì–´ ìŠ¤í ë§ í€´ì¦ˆ">
    <header>
      <div class="title">ì˜ë‹¨ì–´ ìŠ¤í ë§ í€´ì¦ˆ<small>ì¤‘í•™ìƒ(EFL) ë§ì¶¤ | ì •ë‹µ ìŠ¤í ë§ì„ ê³ ë¥´ì„¸ìš”</small></div>
      <div class="controls">
        <label>ë‚œì´ë„
          <select id="level">
            <option value="easy">ì‰¬ì›€</option>
            <option value="medium" selected>ë³´í†µ</option>
            <option value="hard">ì–´ë ¤ì›€</option>
          </select>
        </label>
        <label>ë¬¸í•­ìˆ˜
          <select id="count">
            <option>10</option>
            <option selected>20</option>
            <option>30</option>
          </select>
        </label>
        <label>ì œí•œì‹œê°„(ì´ˆ)
          <input id="limit" type="number" min="0" value="0" style="width:88px" title="0ì€ ë¬´ì œí•œ"/>
        </label>
        <button id="start" class="primary">ê²Œì„ ì‹œì‘</button>
      </div>
    </header>

    <main>
      <div class="statusbar">
        <div class="progress" aria-label="ì§„í–‰ë¥ "><div id="bar"></div></div>
        <div class="stats" aria-live="polite">
          <div>ì ìˆ˜: <b id="score">0</b></div>
          <div>ë¬¸í•­: <b id="qnum">0</b>/<span id="qtotal">0</span></div>
          <div>ì‹œê°„: <b id="time">0</b>s</div>
        </div>
      </div>

      <section class="card" id="quiz">
        <div class="prompt">ì •ë‹µ ìŠ¤í ë§ì„ ê³ ë¥´ì„¸ìš” (1~4 ë‹¨ì¶•í‚¤ ê°€ëŠ¥)</div>
        <h1 class="word" id="question">ì‹œì‘ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”</h1>
        <div class="choices" id="choices"></div>
        <div class="feedback" id="feedback" aria-live="polite"></div>
      </section>

      <section class="card" id="results" style="display:none">
        <h2>ê²°ê³¼</h2>
        <p>ìµœì¢… ì ìˆ˜: <b id="finalScore">0</b> / <span id="finalTotal">0</span></p>
        <div class="actions">
          <button id="retry">ë‹¤ì‹œ í•˜ê¸°</button>
          <button id="shuffle" class="primary">ìƒˆ ë¬¸ì œë¡œ</button>
        </div>
        <h3>ì˜¤ë‹µ ë¦¬ë·°</h3>
        <ul id="review" class="review"></ul>
      </section>
    </main>

    <footer>
      <span>â“˜ íŒ: í‚¤ë³´ë“œ <b>1â€‘4</b>ë¡œ ë¹ ë¥´ê²Œ ë‹µí•  ìˆ˜ ìˆì–´ìš”.</span>
      <span>åˆ¶ä½œè€…: GitHub Pagesì—ì„œ ì •ì  ì‚¬ì´íŠ¸ë¡œ ë°”ë¡œ ë°°í¬ ê°€ëŠ¥í•©ë‹ˆë‹¤.</span>
    </footer>
  </div>

  <script>
    // ====== ì¤‘í•™ìƒ(EFL) ìˆ˜ì¤€ ë‹¨ì–´ ë¦¬ìŠ¤íŠ¸ ======
    const WORDS = [
      "about","across","address","afraid","afternoon","animal","answer","arrive","beautiful","because","before","begin","both","borrow","breakfast","bridge","build","busy","career","certain","change","choose","church","classroom","clever","cloud","color","common","company","country","cousin","culture","danger","decide","delicious","different","difficult","dinner","discover","drink","during","earth","easy","electric","elephant","energy","engineer","enjoy","enough","environment","exercise","favorite","finally","finish","follow","foreign","forget","friend","future","garden","great","healthy","history","holiday","homework","hundred","important","include","international","journey","kitchen","language","library","listen","minute","moments","mountain","music","nature","ocean","parents","people","picture","planet","popular","practice","present","problem","protect","question","really","remember","river","science","season","secret","shoulder","sometimes","special","station","story","street","student","subject","sudden","together","tomorrow","traffic","training","usually","vacation","village","weather","welcome","window","wonderful","world","write"
    ];

    // ====== ìœ í‹¸ë¦¬í‹° ======
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));
    const shuffle = (arr) => arr.sort(() => Math.random() - 0.5);

    // ì² ì êµë€(ë‚œì´ë„ë³„) ìƒì„±ê¸°
    function makeMisspellings(word, level = 'medium'){
      const variants = new Set();
      const vowels = ['a','e','i','o','u'];
      const letters = 'abcdefghijklmnopqrstuvwxyz'.split('');
      const push = (w) => { if(w && w !== word && /^[a-z]+$/.test(w)) variants.add(w); };

      // 1) ì¸ì ‘ ë¬¸ì êµí™˜ (teh -> the)
      for(let i=0;i<word.length-1;i++){
        push(word.slice(0,i) + word[i+1] + word[i] + word.slice(i+2));
      }
      // 2) ëª¨ìŒ êµì²´
      for(let i=0;i<word.length;i++){
        if(vowels.includes(word[i])){
          const picks = level==='easy'? ['a','e','i','o','u'].filter(v=>v!==word[i]).slice(0,1)
                       : level==='medium'? ['a','e','i','o','u'].filter(v=>v!==word[i]).slice(0,2)
                       : ['a','e','i','o','u'].filter(v=>v!==word[i]);
          for(const v of picks){ push(word.slice(0,i)+v+word.slice(i+1)); }
        }
      }
      // 3) ëˆ„ë½/ì¤‘ë³µ ë¬¸ì
      for(let i=0;i<word.length;i++){
        if(level!=='easy') push(word.slice(0,i)+word.slice(i+1));
        if(level!=='easy') push(word.slice(0,i)+word[i]+word[i]+word.slice(i+1));
      }
      // 4) ë°œìŒ í˜¼ë™ ê·œì¹™ ì¼ë¶€
      push(word.replaceAll('c','k'));
      push(word.replaceAll('ph','f'));
      push(word.replaceAll('qu','kw'));
      push(word.replaceAll('ck','k'));

      // 5) ë¬´ì‘ìœ„ í•œ ê¸€ì ì¹˜í™˜(ì–´ë ¤ì›€)
      if(level==='hard'){
        for(let i=0;i<word.length;i++){
          const r = letters[Math.floor(Math.random()*letters.length)];
          push(word.slice(0,i)+r+word.slice(i+1));
        }
      }

      const out = Array.from(variants).filter(w => Math.abs(w.length - word.length) <= (level==='easy'?1:2));
      return shuffle(out).slice(0, 8); // ë„‰ë„‰íˆ ë§Œë“¤ì–´ ë‘ê³  ê³ ë¥´ê¸°
    }

    // ë¬¸ì œ ìƒì„±ê¸°
    function makeQuestion(level){
      const answer = WORDS[Math.floor(Math.random()*WORDS.length)];
      const wrongs = makeMisspellings(answer, level).filter(w => w !== answer);
      const options = shuffle([answer, ...wrongs.slice(0, 3)]);
      return { answer, options };
    }

    // ìƒíƒœ
    const state = {
      level:'medium',
      total:20,
      limit:0,
      qIndex:0,
      score:0,
      started:false,
      timer:null,
      remain:0,
      question:null,
      review:[],
    };

    // ë Œë”ë§
    function renderQuestion(){
      const {answer, options} = state.question;
      $('#question').textContent = 'ì •ë‹µ ìŠ¤í ë§ì„ ê³ ë¥´ì„¸ìš”';
      const container = $('#choices');
      container.innerHTML = '';

      options.forEach((opt, i) => {
        const btn = document.createElement('button');
        btn.className = 'choice';
        btn.innerHTML = `<span>${opt}</span><span class="kbd">${i+1}</span>`;
        btn.addEventListener('click', () => choose(opt, btn));
        container.appendChild(btn);
      });

      $('#feedback').textContent = '';
      $('#qnum').textContent = state.qIndex + 1;
      $('#qtotal').textContent = state.total;
      $('#bar').style.width = `${(state.qIndex/state.total)*100}%`;
    }

    function choose(opt, btn){
      if(!state.started) return;
      const correct = opt === state.question.answer;
      $$('.choice').forEach(b => b.setAttribute('disabled','true'));
      if(correct){
        btn.classList.add('correct');
        state.score++;
        $('#feedback').innerHTML = `<span class="pill ok">ì •ë‹µ!</span> <span>ì˜í–ˆì–´ìš”. ì˜¬ë°”ë¥¸ ì² ì: <b>${state.question.answer}</b></span>`;
      } else {
        btn.classList.add('wrong');
        const correctBtn = $$('.choice').find(b => b.textContent.trim().startsWith(state.question.answer));
        if(correctBtn) correctBtn.classList.add('correct');
        $('#feedback').innerHTML = `<span class="pill no">ì˜¤ë‹µ</span> <span>ì •ë‹µì€ <b>${state.question.answer}</b> ì…ë‹ˆë‹¤.</span>`;
        state.review.push({
          word: state.question.answer,
          picked: opt
        });
      }
      $('#score').textContent = state.score;
      setTimeout(next, 650);
    }

    function next(){
      state.qIndex++;
      if(state.qIndex >= state.total){
        finish();
        return;
      }
      state.question = makeQuestion(state.level);
      renderQuestion();
    }

    function start(){
      state.level = $('#level').value;
      state.total = parseInt($('#count').value, 10);
      state.limit = parseInt($('#limit').value, 10) || 0; // 0ì€ ë¬´ì œí•œ
      state.qIndex = 0; state.score = 0; state.review = [];
      state.started = true; $('#results').style.display='none';
      $('#score').textContent = '0';
      state.question = makeQuestion(state.level);
      renderQuestion();
      $('#bar').style.width = '0%';
      if(state.timer){ clearInterval(state.timer); }
      state.remain = state.limit;
      $('#time').textContent = state.limit;
      if(state.limit>0){
        state.timer = setInterval(() => {
          state.remain--; $('#time').textContent = state.remain;
          if(state.remain <= 0){
            clearInterval(state.timer); finish();
          }
        }, 1000);
      } else {
        $('#time').textContent = 'âˆ';
      }
    }

    function finish(){
      state.started = false;
      if(state.timer){ clearInterval(state.timer); }
      $('#bar').style.width = '100%';
      $('#finalScore').textContent = state.score;
      $('#finalTotal').textContent = state.total;
      $('#results').style.display='block';
      const list = $('#review');
      list.innerHTML = state.review.length? '' : '<li>í›Œë¥­í•´ìš”! ì˜¤ë‹µì´ ì—†ì–´ìš” ğŸ‰</li>';
      state.review.slice(0, 30).forEach(({word, picked}) => {
        const li = document.createElement('li');
        li.textContent = `ì •ë‹µ: ${word} | ì„ íƒ: ${picked}`;
        list.appendChild(li);
      });
    }

    // ì´ë²¤íŠ¸ ë°”ì¸ë”©
    $('#start').addEventListener('click', start);
    $('#retry').addEventListener('click', start);
    $('#shuffle').addEventListener('click', () => { shuffle(WORDS); start(); });

    // ë‹¨ì¶•í‚¤(1~4)
    window.addEventListener('keydown', (e) => {
      if(!state.started) return;
      if(['1','2','3','4'].includes(e.key)){
        const idx = parseInt(e.key,10)-1;
        const btn = $$('.choice')[idx];
        if(btn && !btn.hasAttribute('disabled')) btn.click();
      }
    });
  </script>
</body>
</html>
